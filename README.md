# Домашнее задание к занятию «Хранение в K8s» Стасенко Григорий Михайлович

### Примерное время выполнения задания — 180 минут

### Цель задания

Научиться работать с хранилищами в тестовой среде Kubernetes:
- обеспечить обмен файлами между контейнерами пода;
- создавать **PersistentVolume** (PV) и использовать его в подах через **PersistentVolumeClaim** (PVC);
- объявлять свой **StorageClass** (SC) и монтировать его в под через **PVC**.

Это задание поможет вам освоить базовые принципы взаимодействия с хранилищами в Kubernetes — одного из ключевых навыков для работы с кластерами. На практике Volume, PV, PVC используются для хранения данных независимо от пода, обмена данными между подами и контейнерами внутри пода. Понимание этих механизмов поможет вам упростить проектирование слоя данных для приложений, разворачиваемых в кластере k8s.


------

## Задание 1. Volume: обмен данными между контейнерами в поде
### Задача

Создать Deployment приложения, состоящего из двух контейнеров, обменивающихся данными.

### Шаги выполнения
1. Создать Deployment приложения, состоящего из контейнеров busybox и multitool.
2. Настроить busybox на запись данных каждые 5 секунд в некий файл в общей директории.
3. Обеспечить возможность чтения файла контейнером multitool.


### Что сдать на проверку
- Манифесты:
  - `containers-data-exchange.yaml`
- Скриншоты:
  - описание пода с контейнерами (`kubectl describe pods data-exchange`)
 
<img width="818" height="1171" alt="image" src="https://github.com/user-attachments/assets/34ae1d14-5339-45a3-b7d6-7b1b6bde2b4e" />

  - вывод команды чтения файла (`tail -f <имя общего файла>`)

<img width="802" height="78" alt="image" src="https://github.com/user-attachments/assets/3248cb47-c3ec-4323-a29a-e1a132d1464f" />


------

## Задание 2. PV, PVC
### Задача
Создать Deployment приложения, использующего локальный PV, созданный вручную.

### Шаги выполнения
1. Создать Deployment приложения, состоящего из контейнеров busybox и multitool, использующего созданный ранее PVC
2. Создать PV и PVC для подключения папки на локальной ноде, которая будет использована в поде.

<img width="713" height="168" alt="image" src="https://github.com/user-attachments/assets/51879e1e-56af-40db-9632-010fbea56737" />

3. Продемонстрировать, что контейнер multitool может читать данные из файла в смонтированной директории, в который busybox записывает данные каждые 5 секунд.

<img width="714" height="88" alt="image" src="https://github.com/user-attachments/assets/b9ef7d51-232d-40bc-ae76-58b020a828d7" />

4. Удалить Deployment и PVC. Продемонстрировать, что после этого произошло с PV. Пояснить, почему. (Используйте команду `kubectl describe pv`).


*PV остался, но перешел в статус Retain. Это политака по-умолчанию, заданная параметром Reclaim Policy:  Retain.*
<img width="678" height="462" alt="image" src="https://github.com/user-attachments/assets/4e7e8c50-15cf-45a0-91da-1a3b4f7dfeb9" />

5. Продемонстрировать, что файл сохранился на локальном диске ноды. Удалить PV.  Продемонстрировать, что произошло с файлом после удаления PV. Пояснить, почему.

*Файл остался на месте из за настройки Retain. После удаления PV ресурсы из внешних провайдеров автоматически не удаляются*
<img width="717" height="351" alt="image" src="https://github.com/user-attachments/assets/49abe813-7085-405a-bdfc-7690b69be220" />


### Что сдать на проверку
- Манифесты:
  - `pv-pvc.yaml`
- Скриншоты:
  - каждый шаг выполнения задания, начиная с шага 2.
- Описания:
  - объяснение наблюдаемого поведения ресурсов в двух последних шагах.

------

## Задание 3. StorageClass
### Задача
Создать Deployment приложения, использующего PVC, созданный на основе StorageClass.

### Шаги выполнения

1. Создать Deployment приложения, состоящего из контейнеров busybox и multitool, использующего созданный ранее PVC.
2. Создать SC и PVC для подключения папки на локальной ноде, которая будет использована в поде.

*Создаем SC и PVC c подами:*
<img width="757" height="310" alt="image" src="https://github.com/user-attachments/assets/111aace5-31df-41c7-b77b-380d74e953e0" />
*Однако, мы видим что PV не создаются. Не создаются они, согласно описанию с https://kubernetes.io/docs/concepts/storage/storage-classes/  для локальных SC*
<img width="590" height="552" alt="image" src="https://github.com/user-attachments/assets/97e43614-fcd6-48a4-9086-1b14a7a9d3b9" />
*В целях обучения, я создал PV отдельно, привязав его к SC. Манифест `sc-pvc.yaml`*
<img width="788" height="245" alt="image" src="https://github.com/user-attachments/assets/3ea72082-611c-4af7-88a5-5f730e2da2c7" />



3. Продемонстрировать, что контейнер multitool может читать данные из файла в смонтированной директории, в который busybox записывает данные каждые 5 секунд.

<img width="782" height="258" alt="image" src="https://github.com/user-attachments/assets/da223e60-57c7-4eed-accd-91937c1cd113" />


### Что сдать на проверку
- Манифесты:
  - `sc.yaml`
- Скриншоты:
  - каждый шаг выполнения задания, начиная с шага 2
---
